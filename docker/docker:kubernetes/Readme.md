## 2. 도커 엔진
### 2.1 도커 이미지와 컨테이너
> 이미지와 컨테이너는 도커 엔진에서 사용하는 기본 단위이다.

### 2.1.1 도커 이미지
- 이미지는 컨테이너 생성시 필요한 요소로, 가상 머신 생성시 사용하는 `iso`파일과 비슷한 개념이다.
- 이미지는 여러 개의 계층으로 된 바이너라 파일로 존재하고, 컨테이너의 생성/실행시 `읽기 전용`으로 사용된다.
- 이미지의 이름은 [저장소 이름]/[이미지 이름]:[태그] 형태로 구성된다. 저장소 이름은 일반적으로 생략
```
alicek106/ubuntu:14.04    ubuntu:latest
```

<br>

### 2.1.2 도커 컨테이너
- 도커 이미지를 이용하면 이미지의 목적에 맞는 파일이 들어 있는 파일 시스템과 격리된 시스템 자원 및 네트워크를 사용할 수 있는 **독립된 공간**을 생성할 수 있는데, 이것을 `도커 컨테이너`라 한다.
- 도커 컨테이너는 도커 이미지의 목적에 맞도록 사용되는것이 일반적이다.
- 컨테이너는 이미지를 **읽기 전용**으로 사용하고 이미지에서 변경된 사항만 **컨테이너 계층**에 저장하므로, 컨테이너에서 뭘 하던 이미지는 영향이 없다.
- 컨테이너는 각기 독립된 파일시스템을 제공받으며 호스트와 분리돼 있어, 컨테이너에 무엇을 해도 호스트나 다른 컨테이너에는 아무런 영향을 주지 않는다.

<br>

### 2.2 도커 컨테이너 다루기
### 2.2.1 컨테이너 생성
- docker `run` [OPTIONS] IMAGE [COMMAND] [ARG...] 명령어로 컨테이너의 실행이 가능하다.
```
docker run -i -t ubuntu:14:04
```
- `-i` 옵션은 상호 입출력을, `-t` 옵션은 tty를 활성화해 bash shell을 사용하도록 컨테이너를 설정한다.
- 컨테이너 내부에서 빠져나오는 방법은 아래와 같다
    - 컨테이너 셸에 `exit`입력 (컨테이너 정지)
    - Ctrl + D 입력 (컨테이너 정지)
    - Ctrl + P, Q 입력 (**컨테이너 정지 안함**)
- run 명령어는 아래와 같은 명령어를 한번에 실행하는 것이다
    1. docker `pull` (이미지가 없을 때)
    2. docker `create` (컨테이너 생성)
    3. docker `start`   (컨테이너 실행)
    4. docker `attach`  (컨테이너 내부로 접속, -i -t 옵션 사용시)
- docker statrt [컨테이너 ID] 에서 ID는 앞의 2~3자리만 입력해도 실행된다.
```
docker start 169a848678c3
docker start 169
```

<br>

### 2.2.2 컨테이너 목록 확인
- docker `ps` [OPTIONS]로 컨테이너 목록을 확인할 수 있다. `-a` 옵션은 정지된 컨테이너까지 출력한다.
- 출력되는 목록은 아래와 같다
    - CONTAINER ID
    - IMAGE
    - COMMAND
        - 컨테이너가 시작될 때 실행될 명령어. 대부분의 이미지에 미리 내장돼 있기 때문에 별도로 설정할 필요는 없다. 리눅스 컨테니어는 보통 "/bin/bash"를 실행해 상호 입출력이 가능한 셸 환경을 사용할 수 있다.
        - docker run/create 명령어의 맨 끝 [COMMAND] 부분에 입력해서 컨테이너를 생성할 때 덮어쓸 수 있다.
        ```
        docker run -i -t ubuntu:14.04 echo hello world!
        ```
        - 예로 위의 명령어로 실행된 컨테이너는 "/bin/bash"를 "echo hello world"가 덮어쓰기 때문에 hello world만 출력 후 종료된다. 
    - CREATED
    - STATUS
    - PORTS
        - 컨테이너가 개방한 포트와 호스트에 연결한 포트를 나열한다.
    - NAMES

<br>

### 2.2.3 컨테이너 삭제
- docker `rm` [OPTIONS] CONTAINER [CONTAINER...] 명령어로 컨테이너를 삭제할 수 있다.  -f는 실행중인 컨테이너라도 삭제할 수 있다.
```
docker rm -f mycentos 
```
- 일일이 삭제하기 귀찮을 땐 `prune` 명령어로 모든 정지된 컨테이너를 삭제할 수 있다. -f는 진짜 삭제하냐고 묻지 않게한다.
```
docker container prune -f
```
- docker ps의 -a -q 옵션으로도 삭제할 수 있다. -q는 컨테이너의 ID만 출력하는 역할을 한다.
```
docker stop $(docker ps -a -q)
docker rm $(docker ps -a -q)
```

<br>

### 2.2.4 컨테이너 외부에 노출
- 컨테이너는 가상 머신과 마찬가지로 `가상 IP 주소`를 할당받는다. 기본적으로 도커는 컨테이너에 172.17.0.x의 IP를 순차적으로 할당한다.
```
docker run -i -t --name linux ubuntu:14.04

ifconfig

=====
eth0 --> 172.17.0.2

lo   --> 127.0.0.1
```
- 도커의 NAT IP인 127.17.0.2를 할당받은 [eth0](https://neo-blog.tistory.com/14) 인터페이스와 로컬 호스트인 lo 인터페이스가 있다. 아무런 설정이 없다면 이 컨테이너는 127.17.0.2로 도커가 설치된 호스트에서만 접근 가능하다.(Docker for Mac에서는 호스트에서도 접근 불가)
- 외부에 컨테이너를 노출하기 위해서는 **eth0의 IP와 포트**를 호스트의 IP와 포트에 바인딩해야 한다. -p [호스트포트]:[컨테이너포트] 로 연결 가능하다.
- 아래의 예제는 ubuntu 컨테이너에 apahce 웹서버를 띄우고 호스트의 7777 포트와 웹서버가 실행되는 컨테이너의 80포트를 연결하는 예다.
```
docker run -it -p 7777:80 ubuntu:14.04

# apt-get update
# apt-get install apache2 -y
# service apache2 start
```

<br>

### 2.2.5 컨테이너 애플리케이션 구축
여기부터.. 할게많아서 내일하는걸로


### 2.2.6 도커 볼륨
### 2.2.7 도커 네트워크
### 2.2.8 컨테이너 로깅
### 2.2.9 컨테이너 자원 할당 제한

### 2.3 도커 이미지
### 2.3.1 도커 이미지 생성
### 2.3.2 이미지 구조 이해
### 2.3.3 이미지 추출
### 2.3.4 이미지 배포

### 2.4 Dockerfile
### 2.4.1 이미지를 생성하는 방법
### 2.4.2 Dockerfile 생성
### 2.4.3 Dockerfile 빌드
### 2.4.4 기타 Dockerfile 명령어
### 2.4.5 Dockerfile로 빌드할 때 주의할 점

### 2.5 도커 데몬
### 2.5.1 도커의 구조
### 2.5.2 도커 데몬 실행
### 2.5.3 도커 데몬 설정
### 2.5.4 도커 데몬 모니터링
### 2.5.5 Remote API 라이브러리를 이용한 도커 사용

